@{
    List<Business.Luthier> luthier = ViewBag.Luthier;
    Business.Luthier dadosLuthier = ViewBag.DadosDoLuthier;
    List<Business.Instrumento> instrumentos = ViewBag.Instrumentos;
    List<Business.Habilidade> habilidades = ViewBag.Habilidades;
    List<Business.HabilidadePorLuthier> habilidadesAtualLuthier = ViewBag.HabilidadesDoLuthier;
    List<Business.Servico> todosServicos = ViewBag.Servicos;
    int idDoLuthier = 0;

    if(luthier != null)
    {
        if(luthier.Count > 0)
        {
            idDoLuthier = luthier[0].id;
        }
    }

    var fotoPerfilLuthierAtual = new Business.ImagemLuthier();
    List<Business.ImagemLuthier> imagensDoAtualLuthier = new Business.ImagemLuthier().ListarTodas();
    foreach (var imagem in imagensDoAtualLuthier)
    {
        if (imagem.idLuthier == dadosLuthier.id && imagem.tipoImg == "Foto de perfil")
        {
            fotoPerfilLuthierAtual = imagem;
        }
    }

    // Coletando servico escolhido pelo usuário
    var idServicoEscolhidoPorUsuario = Convert.ToInt32(TempData["servicoEscolhido"]);
    TempData["servFinal"] = idServicoEscolhidoPorUsuario;
    string servicoEscolhidoPorUsuario = "";
    foreach(var ss in todosServicos)
    {
        if(ss.id == idServicoEscolhidoPorUsuario)
        {
            servicoEscolhidoPorUsuario = ss.descricao;
        }
    }

    // Coletando instrumento escolhido pelo usuário
    var idInstrumentoEscolhidoPorUsuario = Convert.ToInt32(TempData["instrumentoEscolhido"]);
    TempData["instFinal"] = idInstrumentoEscolhidoPorUsuario;
    string instrumentoEscolhidoPorUsuario = "";
    foreach(var ii in instrumentos)
    {
        if(ii.id == idInstrumentoEscolhidoPorUsuario)
        {
            instrumentoEscolhidoPorUsuario = ii.nome;
        }
    }

    // Habilidade-Serviço
    Dictionary<int, string> servicoPorHabilidade = new Dictionary<int, string>();
    Dictionary<int, string> instrumentoPorHabilidade = new Dictionary<int, string>();
    int idDaHab = 0;
    int idDoServico = 0;
    int idDoInstrumentoDaHab = 0;
    foreach (var skill in habilidades)
    {
        idDoServico = skill.idServico;
        idDaHab = skill.id;
        foreach (var service in todosServicos)
        {
            if (idDoServico == service.id)
            {
                servicoPorHabilidade.Add(idDaHab, service.descricao);
            }
        }
    }
    // Habilidade-Instrumento
    foreach (var habs in habilidades)
    {
        idDoInstrumentoDaHab = habs.idInstrumento;
        idDaHab = habs.id;
        foreach (var inst in instrumentos)
        {
            if (idDoInstrumentoDaHab == inst.id)
            {
                instrumentoPorHabilidade.Add(idDaHab, inst.nome);
            }
        }
    }
}

<div>
    <div style="float:left;">
        <h2><u>Dados do profissional</u></h2>
        <table class="table">
            <tr>
                <td>ID (Luthier)</td>
                <td>Nome do luthier</td>
                <td>ID (Usuário)</td>
                <td>Avaliação</td>
                <td>CNPJ</td>
                <td>CPF</td>
                <td>Email</td>
                <td>Foto de perfil</td>
            </tr>
            <tr>
                <td>@dadosLuthier.id</td>
                <td>@dadosLuthier.nome</td>
                <td>Pendente</td>
                <td>@dadosLuthier.avaliacao</td>
                <td>@dadosLuthier.cnpj</td>
                <td>@dadosLuthier.cpf</td>
                <td>@dadosLuthier.email</td>
                <td>
                    @if (fotoPerfilLuthierAtual.caminhoImagem == null || fotoPerfilLuthierAtual.idLuthier == 0 || fotoPerfilLuthierAtual.nomeImagem == null || fotoPerfilLuthierAtual.tipoImg == null)
                    {
                        <label>O Luthier ainda não cadastrou uma foto</label>
                    }
                    else
                    {
                        <img src="~/UploadedFiles/profilePhotos/luthier/@fotoPerfilLuthierAtual.nomeImagem" width="200px" height="200px" />
                    }
                </td>
            </tr>
        </table>
        <br />
    </div>
</div>

<form action="~/pedido/solicitar" method="post">
    <input type="hidden" id="idLuthier" name="idLuthier" value="@dadosLuthier.id"/>
    <input type="submit" id="btnSolicitarServico" name="btnSolicitarServico" class="btn btn-secondary" size="55" style="width: 1300px; background: #ffd42a; color: rgba(0,0,0,.5); border: white;" value="Solicitar serviço" />
    @if(instrumentoEscolhidoPorUsuario != "" && servicoEscolhidoPorUsuario != "")
    {
        <br /><small><u>@instrumentoEscolhidoPorUsuario > @servicoEscolhidoPorUsuario</u> (Este será o serviço que você solicitará caso clique no botão acima, conforme a filtragem que realizou há pouco.)</small>
    }
</form>

<br />

<h2><u>Serviços disponíveis pelo profissional</u></h2>
<table class="table">
    <tr >
        <td>Serviço</td>
        <td>Instrumento alvo</td>
    </tr>
    @{
        int teste = 0;
        foreach (var h in habilidadesAtualLuthier)
        {
            <tr>
                <td>@servicoPorHabilidade[h.idHabilidade]</td>
                <td>@instrumentoPorHabilidade[h.idHabilidade]</td>
            </tr>
        }
    }
</table>